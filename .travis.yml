services:
- docker
env:
  global:
  - DOCKER_VERSION=17.06.0~ce-0~ubuntu
  - DOCKER_COMPOSE_VERSION=1.14.0
before_install:
- set -e
- openssl aes-256-cbc -K $encrypted_75458f4a10ed_key -iv $encrypted_75458f4a10ed_iv -in tls.tar.enc -out tls.tar -d
- tar xvf tls.tar
- curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
- sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu
  $(lsb_release -cs) stable"
- sudo apt-get update
- apt-cache showpkg docker-ce
- sudo apt-get -y install docker-ce=${DOCKER_VERSION}
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
  -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin
- docker --version
- docker-compose --version
script:
- docker-compose build --build-arg RUN_TESTS=1 api
- docker-compose up -d
after_script:
- docker-compose down
notifications:
  email:
    on_success: never
    on_failure: never
